# DESCRIPTION
In this workspace, we develop the code for the training and testing pipeline of KNODE in the wrench estimation framework. The main library used for the development of the KNODE model is PyTorch.

The code is divided as follows:

# DATA GENERATION
The data generation process is handled by the data_simulator.py script along with its library Simulation_library.py. These scripts generate the necessary data for training and testing the KNODE model. The generated data is organized into a structured folder, ensuring easy access and management.

## Key Features:
Simulation Parameters: The script allows customization of various simulation parameters such as solver type, simulation time, number of simulations, and digital time step.
MRAV Parameters: Defines the physical parameters of the MRAV (Mass, Gravitational acceleration, Inertia matrix, etc.).
Control Input: The control input sequance is generated by reference tracking using feedback linearization + gravity compensation.
Folder Structure: The generated data is stored in a structured folder with the following layout:

## New data folder structure
data_folder_name/ 
├── simulated_data_i/ (i-th training data) 
│ ├── plots/ (contains plots of the simulated data) 
│ ├── README_data.md (automatically generated text file containing the parameters used to generate the data, including information about the real model) 
│ ├── simulated_data.csv (collected data with the following structure: [T, v_B, gamma, w_B, dv_B])


# KNODE TRAINING
The training process for the KNODE model is managed by the KNODE_train.py script. This script trains the KNODE model using the generated data and saves the trained models in a structured folder.

## Key Features:
Training Parameters: The script allows customization of various training parameters such as the number of experiments, dataset name, model name suffix, and input noise.
Optimization Hyperparameters: Set hyperparameters for the optimization problem, including the percentage of the dataset for training, batch prediction error, list of alphas, learning rate scheduler, epochs patience, range average, maximum epochs, and L2 regularization.
Neural Network Hyperparameters: Configure the neural network architecture, including the number of hidden layers, number of neurons per layer, and activation functions.

## Updated data folder structure

name_of_the_dataset/
├── models_"number_of_neurons_for_each_layer"_"pendix_name"/Activation_function/ 
│  ├── KNODE_training (stored models from the training)
│  │  ├── model_"lookahead".pth (model weights)
│  │  ├── optimizer.pth (optimizer state)
│  │  ├── training_log.txt (log of training metrics)
│  │  ├── loss_curve.png (plot of training and validation and first principle models loss over epochs with moving average)
│  │  ├──  README_model.md (contains all the hyperparameters to train the models and other important informations about the training generated automatically)

# KNODE PREDICTIVITY TESTING
The testing process for the KNODE model is managed by the KNODE_model_test.py script. This script evaluates the KNODE model using the generated test data and saves the results in a structured folder.

## Key Features:
Testing Parameters: The script allows customization of various testing parameters such as the number of tests, type of activation function, number of neurons per layer, model name suffix, list of alphas, prediction length percentage, distance percentage between predictions, transparency, and noise standard deviation.
Error Analysis: The script computes and plots the prediction errors for different alphas and generates violin plots to visualize the error distribution.

## Updated data folder structure

name_of_the_dataset/
├── models_"number_of_neurons_for_each_layer"_"pendix_name"/Activation_function/ (stored models from the training)
│   ├── KNODE_test/ (test results)
│   │   ├── test_set_i/ (results for the i-th test set)
│   │   │   ├── v_B_hat_vs_v_B.pdf (plot of predicted vs actual twist)
│   │   │   ├── violin_plots/ (violin plots of the error)
│   │   │   │   ├── error_alpha_{alpha}.pdf (violin plot for alpha)
│   │   ├── error_alpha_{alpha}.pdf (violin plot for all tests for alpha)
│   │   ├── global.pdf (global violin plot for all alphas)

# OBSERVER TESTING
The testing process for the observer models is managed by the Observer_test.py script. This script evaluates the wrench estimations and computes the errors, then plots the results. The results are saved in a structured folder.

## Key Features:
Testing Parameters: The script allows customization of various testing parameters such as the number of tests, type of activation function, number of neurons per layer, model name suffix, list of alphas, and IMU noise levels.
Error Analysis: The script computes and plots the prediction errors for different alphas and generates violin plots to visualize the error distribution.
Wrench Estimation: The script evaluates the wrench estimations using different observer models and compares them with the ground truth.

## Updated data folder structure

name_of_the_dataset/
├── models_"number_of_neurons_per_layer"_"pendix_name"/ (stored models from the training)
│   ├── observers_test/ (test results)
│   │   ├── alpha_{alpha}/ (results for the specified alpha)
│   │   │   ├── noiseless/ (results without IMU noise)
│   │   │   │   ├── test_set_{kk}/ (results for the k-th test set)
│   │   │   │   │   ├── estimated_wrench.pdf (plot of estimated vs actual wrench)
│   │   │   │   │   ├── violin_wrench_estimation.pdf (violin plot of the wrench estimation error)
│   │   │   │   ├── global/ (global results without IMU noise)
│   │   │   │   │   ├── violin_glob_{alpha}.pdf (global violin plot for the specified alpha)
│   │   │   ├── IMU_noise_{IMU_noise}/ (results with specified IMU noise)
│   │   │   │   ├── test_set_{kk}/ (results for the k-th test set)
│   │   │   │   │   ├── estimated_wrench.pdf (plot of estimated vs actual wrench)
│   │   │   │   │   ├── violin_wrench_estimation.pdf (violin plot of the wrench estimation error)
│   │   │   │   ├── global/ (global results with specified IMU noise)
│   │   │   │   │   ├── violin_glob_{alpha}.pdf (global violin plot for the specified alpha)
│   │   ├── global/ (global results for all alphas and IMU noise levels)
│   │   │   ├── violin_glob.pdf (global violin plot for all alphas and IMU noise levels)

# USAGE
To use this code, follow these steps:
1. Generate the data using `data_simulator.py`.
2. Train the KNODE model using the generated data.
3. Test the KNODE model using the test data.

# REQUIREMENTS
- Python 3.x
- PyTorch
- NumPy
- Matplotlib

## INSTALLATION
To install the required libraries, run:
sh ?????

# CONTACT
For any questions or issues, please contact Gabriele Ruselli at gabrieleruscelli@gmail.com .