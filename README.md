# KNODE Wrench Estimation Framework

## Description
This repository contains the training and testing pipeline for KNODE in the wrench estimation framework. The primary library used for the development of the KNODE model is PyTorch. For a deep theoretical background please refer to [my thesis project]([URL](https://it.overleaf.com/read/fwhwjmkdpdxx#7ae2d0 )) .

## Project Structure

### Data Generation
The data generation process is handled by `data_simulator.py` and `Simulation_library.py`. These scripts generate the necessary data for training and testing the KNODE model. The generated data is stored in a structured folder for easy access and management.

#### Key Features
- **Simulation Parameters**: Customizable solver type, simulation time, number of simulations, and digital time step.
- **MRAV Parameters**: Defines mass, gravitational acceleration, inertia matrix, etc.
- **Control Input**: Generated by reference tracking using feedback linearization + gravity compensation.
- **Folder Structure**:
  ```
  data_folder_name/
  ├── simulated_data_i/
  │   ├── plots/
  │   ├── README_data.md
  │   ├── simulated_data.csv (Columns: [T, v_B, gamma, w_B, dv_B])
  ```

### KNODE Training
The training process is managed by `KNODE_train.py`. This script trains the KNODE model using the generated data and saves the trained models.

#### Key Features
- **Training Parameters**: Customizable dataset name, model name suffix, input noise, etc.
- **Optimization Hyperparameters**: Training dataset percentage, batch prediction error, alphas, learning rate scheduler, etc.
- **Neural Network Hyperparameters**: Number of hidden layers, neurons per layer, activation functions.

#### Folder Structure
  ```
  name_of_the_dataset/
  ├── models_"neurons_per_layer"_"suffix"/Activation_function/
  │   ├── KNODE_training/
  │   │   ├── model_"lookahead".pth
  │   │   ├── optimizer.pth
  │   │   ├── training_log.txt
  │   │   ├── loss_curve.png
  │   │   ├── README_model.md
  ```

### KNODE Predictivity Testing
The testing process is managed by `KNODE_model_test.py`. It evaluates the KNODE model using test data and saves the results.

#### Key Features
- **Testing Parameters**: Number of tests, activation function, neurons per layer, model name suffix, alphas, noise standard deviation.
- **Error Analysis**: Computes and visualizes prediction errors using violin plots.

#### Folder Structure
  ```
  name_of_the_dataset/
  ├── models_"neurons_per_layer"_"suffix"/Activation_function/
  │   ├── KNODE_test/
  │   │   ├── test_set_i/
  │   │   │   ├── v_B_hat_vs_v_B.pdf
  │   │   │   ├── violin_plots/
  │   │   │   │   ├── error_alpha_{alpha}.pdf
  │   │   ├── global.pdf
  ```

### Observer Testing
The observer models are tested using `Observer_test.py`, which evaluates wrench estimations and computes errors.

#### Key Features
- **Testing Parameters**: Number of tests, activation function, neurons per layer, model suffix, alphas, IMU noise levels.
- **Error Analysis**: Computes and visualizes prediction errors.
- **Wrench Estimation**: Evaluates different observer models.

#### Folder Structure
  ```
  name_of_the_dataset/
  ├── models_"neurons_per_layer"_"suffix"/
  │   ├── observers_test/
  │   │   ├── alpha_{alpha}/
  │   │   │   ├── noiseless/
  │   │   │   │   ├── test_set_{kk}/
  │   │   │   │   │   ├── estimated_wrench.pdf
  │   │   │   │   │   ├── violin_wrench_estimation.pdf
  │   │   │   ├── global/
  │   │   │   │   ├── violin_glob_{alpha}.pdf
  ```

## Usage
To use this code, follow these steps:
1. Generate data using `data_simulator.py`.
2. Train the KNODE model using `KNODE_train.py`.
3. Test the KNODE model using `KNODE_model_test.py`.
4. Evaluate observer models using `Observer_test.py`.

## Requirements
- Python 3.x
- PyTorch
- NumPy
- Matplotlib

## Contact
For questions or issues, please contact **Gabriele Ruscelli** at gabrieleruscelli@gmail.com.

